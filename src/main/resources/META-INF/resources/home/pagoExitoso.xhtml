<?xml version="1.0" encoding="UTF-8"?>
<ui:composition lang="es"
                xmlns:f="jakarta.faces.core"
                xmlns:h="jakarta.faces.html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/template/main.xhtml">

    <ui:define name="contenido">
        <h:outputStylesheet>
            /* <![CDATA[ */
            .success-wrapper { padding: 50px 0; background-color: #0f111a; min-height: 90vh; }

            .receipt-card {
                background: #ffffff;
                border-radius: 20px;
                color: #1a1d23;
                max-width: 600px;
                margin: 0 auto;
                position: relative;
                box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            }

            .receipt-header {
                background: #0d6efd;
                padding: 40px 20px;
                color: white;
                text-align: center;
                border-radius: 20px 20px 0 0;
            }

            .check-icon {
                font-size: 3rem;
                background: rgba(255,255,255,0.2);
                width: 80px; height: 80px;
                line-height: 80px;
                border-radius: 50%;
                margin: 0 auto 15px;
            }

            .order-id-badge {
                background: #f8fafc;
                border: 2px dashed #0d6efd;
                padding: 15px;
                border-radius: 12px;
                margin: 20px 0;
            }

            .info-grid { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
            .info-label { color: #64748b; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; }
            .info-value { color: #1e293b; font-weight: 700; text-align: right; }

            .product-list {
                background: #f1f5f9;
                border-radius: 12px;
                padding: 15px;
                margin-top: 20px;
            }

            .product-item {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border-bottom: 1px solid #e2e8f0;
                font-size: 0.9rem;
            }

            .total-section {
                border-top: 2px solid #1e293b;
                margin-top: 20px;
                padding-top: 15px;
                text-align: center;
            }

            @media print {
                .success-wrapper { background: white !important; padding: 0; }
                .btn-home, .btn-print { display: none !important; }
                .receipt-card { box-shadow: none; border: 1px solid #eee; }
            }
            /* ]]> */
        </h:outputStylesheet>

        <div class="success-wrapper">
            <h:panelGroup rendered="#{not empty pagoExitosoBean.pedido}">
                <div class="container">
                    <div class="receipt-card animate__animated animate__fadeIn">

                        <div class="receipt-header">
                            <div class="check-icon">
                                <i class="pi pi-check-circle"></i>
                            </div>
                            <h2 class="fw-bold m-0 text-white">¡Compra Exitosa!</h2>
                            <p class="opacity-75 mb-0 text-white">Hemos recibido tu pago correctamente.</p>
                        </div>

                        <div class="p-4 p-md-5">

                            <div class="alert alert-success border-0 small mb-4 text-center">
                                <i class="pi pi-bolt me-2"></i>
                                <b>¡Pedido en preparación!</b> Ya estamos trabajando en tu orden.
                            </div>

                            <div class="order-id-badge text-center">
                                <span class="text-muted small d-block mb-1">CÓDIGO DE RETIRO EN TIENDA</span>
                                <h3 class="fw-bold text-primary m-0">
                                    ##{pagoExitosoBean.pedido.idPedido}
                                </h3>
                            </div>

                            <h5 class="fw-bold mb-3 border-bottom pb-2">Detalles del Comprobante</h5>
                            <table class="info-grid">
                                <tr>
                                    <td class="info-label">Comercio</td>
                                    <td class="info-value text-dark">Ferremas S.A.</td>
                                </tr>
                                <tr>
                                    <td class="info-label">Punto de Retiro</td>
                                    <td class="info-value text-dark">#{pagoExitosoBean.pedido.sucursal.nombre}</td>
                                </tr>
                                <tr>
                                    <td class="info-label">Fecha</td>
                                    <td class="info-value text-dark">
                                        <h:outputText value="#{pagoExitosoBean.pedido.fecha}">
                                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                                        </h:outputText>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-label">Estado de Transacción</td>
                                    <td class="info-value text-success">APROBADA</td>
                                </tr>
                            </table>

                            <div class="product-list">
                                <ui:repeat value="#{pagoExitosoBean.pedido.detallepedidos}" var="detalle">
                                    <div class="product-item">
                                        <span class="text-dark">#{detalle.producto.nombre} <b class="text-muted">x#{detalle.cantidad}</b></span>
                                        <h:outputText value="#{detalle.producto.precio * detalle.cantidad}" styleClass="fw-bold text-dark">
                                            <f:convertNumber type="currency" currencySymbol="$" />
                                        </h:outputText>
                                    </div>
                                </ui:repeat>
                            </div>

                            <div class="total-section">
                                <span class="text-muted small fw-bold">TOTAL PAGADO</span>
                                <h2 class="fw-bold text-dark">
                                    <h:outputText value="#{pagoExitosoBean.pedido.total}">
                                        <f:convertNumber type="currency" currencySymbol="$" />
                                    </h:outputText>
                                </h2>
                            </div>

                            <div class="text-center mt-5 d-flex gap-2 justify-content-center">
                                <p:button outcome="/home/index.xhtml" value="Volver al Inicio"
                                          icon="pi pi-home"
                                          styleClass="ui-button-secondary rounded-pill px-4 shadow-sm" />

                                <p:commandButton value="Imprimir Recibo" type="button"
                                                 icon="pi pi-print"
                                                 styleClass="ui-button-outlined rounded-pill px-4 btn-print"
                                                 onclick="window.print();" />
                            </div>
                        </div>
                    </div>

                    <p class="text-center text-muted small mt-4">
                        Conserva este comprobante digital para retirar tus productos en la sucursal elegida.
                    </p>
                </div>
            </h:panelGroup>

            <h:panelGroup rendered="#{empty pagoExitosoBean.pedido}">
                <div class="container text-center py-5">
                    <i class="pi pi-search text-muted mb-4" style="font-size: 3rem;"></i>
                    <h3 class="text-white">Validando transacción...</h3>
                    <p class="text-muted">Si acabas de pagar, espera unos segundos mientras actualizamos tu pedido.</p>
                </div>
            </h:panelGroup>
        </div>
    </ui:define>
</ui:composition>